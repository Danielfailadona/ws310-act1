<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Age Calculator</title>
    <link rel="stylesheet" href="../crud/crud.css">
    <link rel="stylesheet" href="age-cal.css">
</head>
<body>

<div class="main">
    <h1>Age Calculator - All Applicants</h1>

    <table class="age-calculator-table">
        <thead>
            <tr>
                <th>ID</th>
                <th>First Name</th>
                <th>Last Name</th>
                <th>Date of Birth</th>
                <th>Calculated Age</th>
            </tr>
        </thead>
        <tbody id="applicants-table-body">
            <!-- Data will be loaded here -->
        </tbody>
    </table>

    <div class="footer-actions">
        <button class="btn btn-add" onclick="window.location.href='../crud/crud.html'">Back</button>
    </div>
</div>

<script>
    let applicantsData = [];

    // Load data from server
    async function loadApplicantsData() {
        try {
            const response = await fetch('read_with_age.php');
            applicantsData = await response.json();
            renderApplicantsTable();
        } catch (error) {
            console.error('Error loading applicants data:', error);
            document.getElementById('applicants-table-body').innerHTML = '<tr><td colspan="5">Error loading data</td></tr>';
        }
    }

    const tableBody = document.getElementById('applicants-table-body');

    // Render function using forEach
    function renderApplicantsTable() {
        // Clear existing content
        tableBody.innerHTML = "";

        // Loop through each applicant in the array
        applicantsData.forEach((applicant) => {
            const ageDisplay = applicant.age !== null ? applicant.age + ' years' : 'N/A';
            const row = `
                <tr>
                    <td class="id-col">${applicant.applicant_id || 'N/A'}</td>
                    <td>${applicant.fname || 'N/A'}</td>
                    <td>${applicant.lname || 'N/A'}</td>
                    <td>${applicant.dbirth || 'N/A'}</td>
                    <td class="age-highlight">${ageDisplay}</td>
                </tr>
            `;
            tableBody.innerHTML += row;
        });
    }


    // Initial call to display the data
    loadApplicantsData();
</script>

</body>
</html>