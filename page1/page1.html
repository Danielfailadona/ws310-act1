<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="page1.css">
</head>
<body>
    <div id="success-message" style="display: none; background: #d4edda; color: #155724; padding: 15px; margin: 20px; border-radius: 4px; text-align: center; border: 1px solid #c3e6cb;">Personal record submitted successfully!</div>
    <div class="main">
        <form action="page1.php" method="post">
            <div class="top-most" id="top-most">
                <b>Personal Record</b>
                <div class="fp-box" id="ssnum">
                    <p>SS Number:</p>
                    <input type="text" name="ssnum" placeholder="SS Number: ">
                </div>
            </div>

            <div class="part1">
                <b>A. Personal Data</b>
                <div class="name">
                    <p>Name</p>
                    <div class="name-cont">
                        <div class="fp-box" id="lname">
                            <p>Last Name:</p>
                            <input type="text" name="lname" placeholder="Last Name: ">
                        </div>
                            
                        <div class="fp-box" id="fname">
                            <p>First Name:</p>
                            <input type="text" name="fname" placeholder="First Name: ">
                        </div>
                            
                        <div class="fp-box" id="mname">
                            <p>Middle Name:</p>
                            <input type="text" name="mname" placeholder="Middle Name: ">
                        </div>
                            
                        <div class="fp-box" id="sfx">
                            <p>Suffix:</p>
                            <input type="text" name="sfx" placeholder="Suffix: ">
                        </div>

                        <div class="fp-box" id="dbirth">
                            <p>Date of Birth (MM/DD/YYYY):</p>
                            <input type="date" name="dbirth">
                        </div>
                    </div>
                </div>

                

                <div class="check-box" id="sex-opt">
                    <p>Sex:</p>
                    <div class="options">
                        <input type="radio" name="sex" value="Male"> <span>Male</span>
                        <input type="radio" name="sex" value="Female"> <span>Female</span>
                    </div>
                </div>

                <div class="check-box" id="cvstatus-opt">
                    <p>Civil Status:</p>
                    <div class="options">
                        <input type="radio" name="cvstatus" value="Single" class="cvstatus-radio"> <span>Single</span>
                        <input type="radio" name="cvstatus" value="Married" class="cvstatus-radio"> <span>Married</span>
                        <input type="radio" name="cvstatus" value="Widowed" class="cvstatus-radio"> <span>Widowed</span>
                        <input type="radio" name="cvstatus" value="Legally Separated" class="cvstatus-radio"> <span>Legally Separated</span>
                        <input type="radio" name="cvstatus" value="Others" id="cvstatus-others" class="cvstatus-radio"> <span>Others</span>
                        <input type="text" name="cvstatus_other" id="cvstatus-other-input" placeholder="Please specify" disabled>
                    </div>
                </div>

                    <div class="long-fp-box" id="taxid">
                        <p>Tax Idenification Number (If Any):</p>
                        <input type="text" name="taxid" placeholder="000-000-000">
                    </div>

                    <div class="long-fp-box" id="nation">
                        <p>Nationality:</p>
                        <input type="text" name="nation" placeholder="Nationality: ">
                    </div>

                    <div class="long-fp-box" id="religion">
                        <p>Religion:</p>
                        <input type="text" name="religion" placeholder="Religion: ">
                    </div>
                    <div class="long-fp-box-check-btn" id="pbirth">
                        <p>Place of Birth: (City/Municipality/Province) <br>(City/Country, if born outside of Phillipines)</p>
                        <input type="text" name="pbirth" id="pbirth-input" placeholder="Place of Birth: " style="margin-bottom: 10px;">
                        <div class="check-box-inline">
                            <input type="checkbox" id="same-address-checkbox">
                            <label for="same-address-checkbox">Same as Home Address</label>
                        </div>
                    </div>
                    
                    <div class="home-adress-cont">
                        <p>Home Address </p>
                        <div class="home-adress">
                            <div class="fp-box" id="address-1">
                                <p>(Rm/Flr/Unit No. & Building name):</p>
                                <input type="text" name="address-1">
                            </div>

                            <div class="fp-box" id="address-2">
                                <p>(House/Lot & Blk. No.):</p>
                                <input type="text" name="address-2">
                            </div>
                            
                            <div class="fp-box" id="address-3">
                                <p>(Street Name):</p>
                                <input type="text" name="address-3">
                            </div>

                            <div class="fp-box" id="address-4">
                                <p>(Subdivision):</p>
                                <input type="text" name="address-4">
                            </div>
                        </div>

                        <div class="home-adress-layer2" id="address-layer2">
                            <div class="fp-box" id="address-5">
                                <p>(Barangay/District/Locality):</p>
                                <input type="text" name="address-5">
                            </div>

                            <div class="fp-box" id="address-6">
                                <p>(City/Municipality):</p>
                                <input type="text" name="address-6" id="address-6-input">
                            </div>

                            <div class="fp-box" id="address-7">
                                <p>(Province):</p>
                                <input type="text" name="address-7" id="address-7-input">
                            </div>
                            
                            <div class="fp-box" id="address-8">
                                <p>(Country):</p>
                                <input type="text" name="address-8" id="address-8-input">
                            </div>
                            
                            <div class="fp-box" id="address-9">
                                <p>Zip Code:</p>
                                <input type="text" name="address-9">
                            </div>
                        </div>
                    </div>

                    <div class="long-fp-box" id="cphone">
                        <p>Mobile/Cellphone Number:</p>
                        <input type="text" name="cphone">
                    </div>

                    <div class="long-fp-box" id="email">
                        <p>E-Mail:</p>
                        <input type="email" name="email">
                    </div>

                    <div class="long-fp-box" id="tphone">
                        <p>Telephone Number <br>(Country Code + Area Code + Tel. No.):</p>
                        <input type="text" name="tphone">
                    </div>

                    <div class="father-cont">
                        <p>Father</p>
                        <div class="father">
                            <div class="fp-box" id="lfather">
                                <p>(Last Name):</p>
                                <input type="text" name="lfather">
                            </div>

                            <div class="fp-box" id="ffather">
                                <p>(First Name):</p>
                                <input type="text" name="ffather">
                            </div>

                            <div class="fp-box" id="mfather">
                                <p>(Middle Name):</p>
                                <input type="text" name="mfather">
                            </div>

                            <div class="fp-box" id="sfxfather">
                                <p>(Suffix):</p>
                                <input type="text" name="sfxfather">
                            </div>

                            <div class="fp-box" id="fbirth">
                                <p>Date of Birth (MM/DD/YYYY):</p>
                                <input type="date" name="fbirth">
                            </div>
                        </div>
                    </div>
                    
                    <div class="mother-cont">
                        <p>Mother's Maiden Name</p>
                        <div class="mother">
                            <div class="fp-box" id="lmother">
                                <p>(Last Name):</p>
                                <input type="text" name="lmother">
                            </div>

                            <div class="fp-box" id="fmother">
                                <p>(First Name):</p>
                                <input type="text" name="fmother">
                            </div>

                            <div class="fp-box" id="mmother">
                                <p>(Middle Name):</p>
                                <input type="text" name="mmother">
                            </div>

                            <div class="fp-box" id="sfxmother">
                                <p>(Suffix):</p>
                                <input type="text" name="sfxmother">
                            </div>

                            <div class="fp-box" id="mbirth">
                                <p>Date of Birth (MM/DD/YYYY):</p>
                                <input type="date" name="mbirth">
                            </div>
                        </div>
                    </div>
            </div>
<!-- /////////////////////////////////////////////////////////////////////////////////// -->
            <div class="part2">
                <b>B. Dependent(s)/Benefeciary/ies</b>
                <div class="spouse-cont">
                    <p>Spouse</p>
                    <div class="spouse">
                        <div class="fp-box" id="lspouse">
                            <p>(Last Name):</p>
                            <input type="text" name="lspouse">
                        </div>

                        <div class="fp-box" id="fspouse">
                            <p>(First Name):</p>
                            <input type="text" name="fspouse">
                        </div>

                        <div class="fp-box" id="mspouse">
                            <p>(Middle Name):</p>
                            <input type="text" name="mspouse">
                        </div>

                        <div class="fp-box" id="sfxspouse">
                            <p>(Suffix):</p>
                            <input type="text" name="sfxspouse">
                        </div>

                        <div class="fp-box" id="sbirth">
                            <p>Date of Birth (MM/DD/YYYY):</p>
                            <input type="date" name="sbirth">
                        </div>
                    </div>
                </div>

                <div id="children-container">
                    <div class="child-entry" data-child-num="1">
                        <p>Child 1</p>
                        <div class="child-fields">
                            <div class="fp-box">
                                <p>(Last Name):</p>
                                <input type="text" name="children[0][lname]">
                            </div>

                            <div class="fp-box">
                                <p>(First Name):</p>
                                <input type="text" name="children[0][fname]">
                            </div>

                            <div class="fp-box">
                                <p>(Middle Name):</p>
                                <input type="text" name="children[0][mname]">
                            </div>

                            <div class="fp-box">
                                <p>(Suffix):</p>
                                <input type="text" name="children[0][sfx]">
                            </div>

                            <div class="fp-box">
                                <p>Date of Birth (MM/DD/YYYY):</p>
                                <input type="date" name="children[0][dbirth]">
                            </div>
                        </div>
                    </div>
                </div>
                
                <button type="button" id="add-child-btn" class="btn-add-child">+ Add Another Child</button>
            </div>
<!-- /////////////////////////////////////////////////////////////////////////////////// -->
            <div class="part3">
                <div class="se">
                    <div class="fp-box" id="profession">
                        <p>Profession/Business:</p>
                        <input type="text" name="profession">
                    </div>

                    <div class="fp-box" id="ystart">
                        <p>Year Started:</p>
                        <input type="text" name="ystart" placeholder="Year Started: ">
                    </div>

                    <div class="fp-box" id="mearning">
                        <p>Monthly Earning:</p>
                        <input type="number" name="mearning" step="0.01" placeholder="Monthly Earning: ">
                    </div>
                </div>

                <div class="ofw">
                    <div class="fp-box" id="faddress">
                        <p>Foreign Address:</p>
                        <input type="text" name="faddress">
                    </div>

                    <div class="fp-box" id="mearning">
                        <p>Monthly Earning:</p>
                        <input type="number" name="mearning" step="0.01" placeholder="Monthly Earning: ">
                    </div>
                </div>

                <div class="nws">
                    <div class="fp-box" id="spouse-ssnum">
                        <p>Spouse's SS Number:</p>
                        <input type="text" name="spouse-ssnum">
                    </div>

                    <div class="fp-box" id="ffprogram">
                        <p>Spouse's Monthly Income:</p>
                        <input type="number" name="ffprogram" step="0.01" placeholder="Monthly Earning: ">
                    </div>

                    <div class="button-group">
                        <p>Flexi-Fund Program:</p>
                        <div class="options">
                            <input type="radio" name="ffp" value="yes"> <span>Yes</span>
                            <input type="radio" name="ffp" value="No"> <span>No</span>
                        </div>
                    </div>
                </div>
            </div>
<!-- /////////////////////////////////////////////////////////////////////////////////// -->
            <div class="part4">
                <b>C. Certification</b>
                <p>I certify that the information provided in this form are true and correct.</p>
                <p>(If registrant cannot sign, affix fingerprints in the presence of an SSS personnel.)</p>
                <p>Registrant is required to affix fingerprints.</p>
                
                <div class="cert-row">
                    <div class="fp-box" id="printed-name">
                        <p>Printed Name:</p>
                        <input type="text" name="printed-name">
                    </div>
                    
                    <div class="fp-box" id="signature">
                        <p>Signature:</p>
                        <div class="signature-area">Signature Area</div>
                    </div>
                    
                    <div class="fp-box" id="cert-date">
                        <p>Date:</p>
                        <input type="date" name="cert-date">
                    </div>
                    
                    <div class="fp-box" id="thumb-mark">
                        <p>Right Thumb Mark:</p>
                        <div class="signature-area">Thumbprint Area</div>
                    </div>
                    
                    <div class="fp-box" id="index-finger">
                        <p>Right Index Finger:</p>
                        <div class="signature-area">Fingerprint Area</div>
                    </div>
                </div>
            </div>
<!-- /////////////////////////////////////////////////////////////////////////////////// -->
            <div class="part5">
                <b>D. For SSS Use Only</b>
                
                <div class="sss-row">
                    <div class="fp-box" id="alphabet-code">
                        <p>Alphabet Code (For SE):</p>
                        <div class="sss-area"></div>
                    </div>
                    
                    <div class="fp-box" id="working-spouse">
                        <p>Working Spouse's Name (For NWS):</p>
                        <div class="sss-area"></div>
                    </div>
                    
                    <div class="fp-box" id="received-rep">
                        <p>Received By Representative:</p>
                        <div class="sss-area"></div>
                    </div>
                </div>
                
                <div class="long-fp-box" id="received-processed">
                    <p>Received & Processed By SSS Branch:</p>
                    <div class="sss-area"></div>
                </div>
            </div>

            <input type="hidden" name="same_as_pbirth" id="same-as-pbirth-hidden" value="0">
            <input type="hidden" name="applicant_id" id="applicant-id" value="">
            <input type="submit" value="submit">
            <input type="button" value="update" id="update-btn" style="display:none;" onclick="updateRecord()">
        </form>
    </div>
    
    <script>
        // Check if we're in edit mode (has edit parameter in URL)
        const urlParams = new URLSearchParams(window.location.search);
        const editId = urlParams.get('edit');

        if (editId) {
            // We're in edit mode, hide submit button and show update button
            document.querySelector('input[type="submit"]').style.display = 'none';
            document.getElementById('update-btn').style.display = 'inline-block';

            // Load the applicant data
            loadApplicantData(editId);
        }

        // Function to load applicant data for editing
        async function loadApplicantData(id) {
            try {
                const response = await fetch('../crud/crud.php?action=read_single&id=' + id);
                const data = await response.json();

                if (data) {
                    const applicant = data.applicant;
                    const address = data.address;
                    const parents = data.parents;
                    const spouse = data.spouse;
                    const children = data.children;
                    const employment = data.employment;
                    const debugInfo = data.debug_info;

                    // Show detailed information about what data was retrieved from each table
                    if (debugInfo) {
                        let debugMsg = "Data Retrieved from Database:\n\n";

                        // Show main applicant data in the requested format
                        if (applicant) {
                            debugMsg += "APPLICANT DATA:\n";
                            debugMsg += "ssnum: " + (applicant.ssnum || 'N/A') + "\n";
                            debugMsg += "lname: " + (applicant.lname || 'N/A') + "\n";
                            debugMsg += "fname: " + (applicant.fname || 'N/A') + "\n";
                            debugMsg += "mname: " + (applicant.mname || 'N/A') + "\n";
                            debugMsg += "sfx: " + (applicant.sfx || 'N/A') + "\n";
                            debugMsg += "dbirth: " + (applicant.dbirth || 'N/A') + "\n";
                            debugMsg += "sex: " + (applicant.sex || 'N/A') + "\n";
                            debugMsg += "cvstatus: " + (applicant.cvstatus || 'N/A') + "\n";
                            debugMsg += "cvstatus_other: " + (applicant.cvstatus_other || 'N/A') + "\n";
                            debugMsg += "taxid: " + (applicant.taxid || 'N/A') + "\n";
                            debugMsg += "nation: " + (applicant.nation || 'N/A') + "\n";
                            debugMsg += "religion: " + (applicant.religion || 'N/A') + "\n";
                            debugMsg += "pbirth: " + (applicant.pbirth || 'N/A') + "\n";
                            debugMsg += "cphone: " + (applicant.cphone || 'N/A') + "\n";
                            debugMsg += "email: " + (applicant.email || 'N/A') + "\n";
                            debugMsg += "tphone: " + (applicant.tphone || 'N/A') + "\n";
                            debugMsg += "printed_name: " + (applicant.printed_name || 'N/A') + "\n";
                            debugMsg += "cert_date: " + (applicant.cert_date || 'N/A') + "\n\n";
                        } else {
                            debugMsg += "APPLICANT DATA: No data found\n\n";
                        }

                        // Show address data in the requested format
                        if (address) {
                            debugMsg += "ADDRESS DATA:\n";
                            debugMsg += "address_1: " + (address.address_1 || 'N/A') + "\n";
                            debugMsg += "address_2: " + (address.address_2 || 'N/A') + "\n";
                            debugMsg += "address_3: " + (address.address_3 || 'N/A') + "\n";
                            debugMsg += "address_4: " + (address.address_4 || 'N/A') + "\n";
                            debugMsg += "address_5: " + (address.address_5 || 'N/A') + "\n";
                            debugMsg += "address_6: " + (address.address_6 || 'N/A') + "\n";
                            debugMsg += "address_7: " + (address.address_7 || 'N/A') + "\n";
                            debugMsg += "address_8: " + (address.address_8 || 'N/A') + "\n";
                            debugMsg += "address_9: " + (address.address_9 || 'N/A') + "\n";
                            debugMsg += "same_as_pbirth: " + (address.same_as_pbirth ? 'Yes' : 'No') + "\n\n";
                        } else {
                            debugMsg += "ADDRESS DATA: No data found\n\n";
                        }

                        // Show parents data in the requested format
                        if (parents) {
                            debugMsg += "PARENTS DATA:\n";
                            debugMsg += "lfather: " + (parents.lfather || 'N/A') + "\n";
                            debugMsg += "ffather: " + (parents.ffather || 'N/A') + "\n";
                            debugMsg += "mfather: " + (parents.mfather || 'N/A') + "\n";
                            debugMsg += "sfxfather: " + (parents.sfxfather || 'N/A') + "\n";
                            debugMsg += "fbirth: " + (parents.fbirth || 'N/A') + "\n";
                            debugMsg += "lmother: " + (parents.lmother || 'N/A') + "\n";
                            debugMsg += "fmother: " + (parents.fmother || 'N/A') + "\n";
                            debugMsg += "mmother: " + (parents.mmother || 'N/A') + "\n";
                            debugMsg += "sfxmother: " + (parents.sfxmother || 'N/A') + "\n";
                            debugMsg += "mbirth: " + (parents.mbirth || 'N/A') + "\n\n";
                        } else {
                            debugMsg += "PARENTS DATA: No data found\n\n";
                        }

                        // Show spouse data in the requested format
                        if (spouse) {
                            debugMsg += "SPOUSE DATA:\n";
                            debugMsg += "lspouse: " + (spouse.lspouse || 'N/A') + "\n";
                            debugMsg += "fspouse: " + (spouse.fspouse || 'N/A') + "\n";
                            debugMsg += "mspouse: " + (spouse.mspouse || 'N/A') + "\n";
                            debugMsg += "sfxspouse: " + (spouse.sfxspouse || 'N/A') + "\n";
                            debugMsg += "sbirth: " + (spouse.sbirth || 'N/A') + "\n\n";
                        } else {
                            debugMsg += "SPOUSE DATA: No data found\n\n";
                        }

                        // Show children data in the requested format
                        if (children && children.length > 0) {
                            debugMsg += "CHILDREN DATA (" + children.length + " found):\n";
                            children.forEach((child, index) => {
                                debugMsg += "Child " + (index + 1) + ":\n";
                                debugMsg += "  lname: " + (child.lname || 'N/A') + "\n";
                                debugMsg += "  fname: " + (child.fname || 'N/A') + "\n";
                                debugMsg += "  mname: " + (child.mname || 'N/A') + "\n";
                                debugMsg += "  sfx: " + (child.sfx || 'N/A') + "\n";
                                debugMsg += "  dbirth: " + (child.dbirth || 'N/A') + "\n\n";
                            });
                        } else {
                            debugMsg += "CHILDREN DATA: No data found\n\n";
                        }

                        // Show employment data in the requested format
                        if (employment) {
                            debugMsg += "EMPLOYMENT DATA:\n";
                            debugMsg += "employment_type: " + (employment.employment_type || 'N/A') + "\n";
                            debugMsg += "profession: " + (employment.profession || 'N/A') + "\n";
                            debugMsg += "ystart: " + (employment.ystart || 'N/A') + "\n";
                            debugMsg += "mearning: " + (employment.mearning || 'N/A') + "\n";
                            debugMsg += "faddress: " + (employment.faddress || 'N/A') + "\n";
                            debugMsg += "ofw_monthly_earnings: " + (employment.ofw_monthly_earnings || 'N/A') + "\n";
                            debugMsg += "spouse_ssnum: " + (employment.spouse_ssnum || 'N/A') + "\n";
                            debugMsg += "ffprogram: " + (employment.ffprogram || 'N/A') + "\n";
                            debugMsg += "ffp: " + (employment.ffp || 'N/A') + "\n\n";
                        } else {
                            debugMsg += "EMPLOYMENT DATA: No data found\n\n";
                        }

                        debugMsg += "Data retrieval completed successfully!";
                        // alert(debugMsg);
                    }

                    // Show alerts for retrieved data
                    // if (applicant) {
                    //     alert("Applicant data retrieved:\n" +
                    //           "ID: " + (applicant.applicant_id || 'N/A') + "\n" +
                    //           "Name: " + (applicant.fname || '') + " " + (applicant.lname || '') + "\n" +
                    //           "SS Number: " + (applicant.ssnum || 'N/A') + "\n" +
                    //           "Date of Birth: " + (applicant.dbirth || 'N/A') + "\n" +
                    //           "Sex: " + (applicant.sex || 'N/A') + "\n" +
                    //           "Civil Status: " + (applicant.cvstatus || 'N/A') + "\n" +
                    //           "Email: " + (applicant.email || 'N/A') + "\n" +
                    //           "Phone: " + (applicant.cphone || 'N/A'));
                    // }

                    // if (address) {
                    //     alert("Address data retrieved:\n" +
                    //           "Address Line 1: " + (address.address_1 || 'N/A') + "\n" +
                    //           "Address Line 2: " + (address.address_2 || 'N/A') + "\n" +
                    //           "City: " + (address.address_6 || 'N/A') + "\n" +
                    //           "Province: " + (address.address_7 || 'N/A') + "\n" +
                    //           "Country: " + (address.address_8 || 'N/A') + "\n" +
                    //           "ZIP Code: " + (address.address_9 || 'N/A'));
                    // }

                    // if (parents) {
                    //     alert("Parent data retrieved:\n" +
                    //           "Father's Name: " + (parents.lfather || '') + ", " + (parents.ffather || '') + " " + (parents.mfather || '') + "\n" +
                    //           "Father's Suffix: " + (parents.sfxfather || 'N/A') + "\n" +
                    //           "Father's Birth: " + (parents.fbirth || 'N/A') + "\n" +
                    //           "Mother's Name: " + (parents.lmother || '') + ", " + (parents.fmother || '') + " " + (parents.mmother || '') + "\n" +
                    //           "Mother's Suffix: " + (parents.sfxmother || 'N/A') + "\n" +
                    //           "Mother's Birth: " + (parents.mbirth || 'N/A'));
                    // }

                    // if (spouse) {
                    //     alert("Spouse data retrieved:\n" +
                    //           "Spouse's Name: " + (spouse.lspouse || '') + ", " + (spouse.fspouse || '') + " " + (spouse.mspouse || '') + "\n" +
                    //           "Spouse's Suffix: " + (spouse.sfxspouse || 'N/A') + "\n" +
                    //           "Spouse's Birth: " + (spouse.sbirth || 'N/A'));
                    // }

                    // if (children && children.length > 0) {
                    //     let childInfo = "Children data retrieved:\n";
                    //     children.forEach((child, index) => {
                    //         childInfo += "Child " + (index + 1) + ": " + (child.fname || '') + " " + (child.lname || '') +
                    //                      " (DOB: " + (child.dbirth || 'N/A') + ")\n";
                    //     });
                    //     alert(childInfo);
                    // }

                    // if (employment) {
                    //     alert("Employment data retrieved:\n" +
                    //           "Profession: " + (employment.profession || 'N/A') + "\n" +
                    //           "Year Started: " + (employment.ystart || 'N/A') + "\n" +
                    //           "Monthly Earnings: " + (employment.mearning || 'N/A') + "\n" +
                    //           "Foreign Address: " + (employment.faddress || 'N/A') + "\n" +
                    //           "Spouse SS Number: " + (employment.spouse_ssnum || 'N/A'));
                    // }

                    // Fill the main applicant form with the applicant data
                    document.getElementById('applicant-id').value = applicant.applicant_id || id;
                    document.querySelector('input[name="ssnum"]').value = applicant.ssnum || '';
                    document.querySelector('input[name="lname"]').value = applicant.lname || '';
                    document.querySelector('input[name="fname"]').value = applicant.fname || '';
                    document.querySelector('input[name="mname"]').value = applicant.mname || '';
                    document.querySelector('input[name="sfx"]').value = applicant.sfx || '';

                    // Set date of birth
                    if (applicant.dbirth) {
                        document.querySelector('input[name="dbirth"]').value = applicant.dbirth;
                    }

                    // Set sex radio button
                    if (applicant.sex) {
                        const sexRadio = document.querySelector(`input[name="sex"][value="${applicant.sex}"]`);
                        if (sexRadio) sexRadio.checked = true;
                    }

                    // Set civil status
                    if (applicant.cvstatus) {
                        const cvstatusRadio = document.querySelector(`input[name="cvstatus"][value="${applicant.cvstatus}"]`);
                        if (cvstatusRadio) cvstatusRadio.checked = true;
                    }

                    // Set other civil status if applicable
                    if (applicant.cvstatus_other) {
                        document.querySelector('input[name="cvstatus_other"]').value = applicant.cvstatus_other;
                        document.getElementById('cvstatus-other-input').disabled = false;
                    }

                    // Set other fields - making sure each field goes to the correct input
                    document.querySelector('input[name="taxid"]').value = applicant.taxid || '';
                    document.querySelector('input[name="nation"]').value = applicant.nation || '';  // nation field goes to nation input
                    document.querySelector('input[name="religion"]').value = applicant.religion || '';
                    document.querySelector('input[name="pbirth"]').value = applicant.pbirth || '';
                    document.querySelector('input[name="cphone"]').value = applicant.cphone || '';
                    document.querySelector('input[name="email"]').value = applicant.email || '';
                    document.querySelector('input[name="tphone"]').value = applicant.tphone || '';
                    document.querySelector('input[name="printed-name"]').value = applicant.printed_name || '';

                    // Set certification date if exists
                    if (applicant.cert_date) {
                        document.querySelector('input[name="cert-date"]').value = applicant.cert_date;
                    }

                    // Fill address fields if available
                    if (address) {
                        document.querySelector('input[name="address-1"]').value = address.address_1 || '';
                        document.querySelector('input[name="address-2"]').value = address.address_2 || '';
                        document.querySelector('input[name="address-3"]').value = address.address_3 || '';
                        document.querySelector('input[name="address-4"]').value = address.address_4 || '';
                        document.querySelector('input[name="address-5"]').value = address.address_5 || '';
                        document.querySelector('input[name="address-6"]').value = address.address_6 || '';
                        document.querySelector('input[name="address-7"]').value = address.address_7 || '';
                        document.querySelector('input[name="address-8"]').value = address.address_8 || '';
                        document.querySelector('input[name="address-9"]').value = address.address_9 || '';

                        // Set same as place of birth checkbox
                        if (address.same_as_pbirth) {
                            document.getElementById('same-address-checkbox').checked = true;
                            document.getElementById('address-layer2').style.opacity = '0.5';
                            document.getElementById('address-layer2').style.pointerEvents = 'none';
                        }
                    }

                    // Fill parents fields if available
                    if (parents) {
                        document.querySelector('input[name="lfather"]').value = parents.lfather || '';
                        document.querySelector('input[name="ffather"]').value = parents.ffather || '';
                        document.querySelector('input[name="mfather"]').value = parents.mfather || '';
                        document.querySelector('input[name="sfxfather"]').value = parents.sfxfather || '';

                        if (parents.fbirth) {
                            document.querySelector('input[name="fbirth"]').value = parents.fbirth;
                        }

                        document.querySelector('input[name="lmother"]').value = parents.lmother || '';
                        document.querySelector('input[name="fmother"]').value = parents.fmother || '';
                        document.querySelector('input[name="mmother"]').value = parents.mmother || '';
                        document.querySelector('input[name="sfxmother"]').value = parents.sfxmother || '';

                        if (parents.mbirth) {
                            document.querySelector('input[name="mbirth"]').value = parents.mbirth;
                        }
                    }

                    // Fill spouse fields if available
                    if (spouse) {
                        document.querySelector('input[name="lspouse"]').value = spouse.lspouse || '';
                        document.querySelector('input[name="fspouse"]').value = spouse.fspouse || '';
                        document.querySelector('input[name="mspouse"]').value = spouse.mspouse || '';
                        document.querySelector('input[name="sfxspouse"]').value = spouse.sfxspouse || '';

                        if (spouse.sbirth) {
                            document.querySelector('input[name="sbirth"]').value = spouse.sbirth;
                        }
                    }

                    // Fill children fields if available
                    if (children && children.length > 0) {
                        const container = document.getElementById('children-container');
                        container.innerHTML = ''; // Clear existing children

                        children.forEach((child, index) => {
                            // Create new child entry
                            const newChild = document.createElement('div');
                            newChild.className = 'child-entry';
                            newChild.setAttribute('data-child-num', index + 1);

                            newChild.innerHTML = `
                                <p>Child ${index + 1}</p>
                                <div class="child-fields">
                                    <div class="fp-box">
                                        <p>(Last Name):</p>
                                        <input type="text" name="children[${index}][lname]" value="${child.lname || ''}">
                                    </div>
                                    <div class="fp-box">
                                        <p>(First Name):</p>
                                        <input type="text" name="children[${index}][fname]" value="${child.fname || ''}">
                                    </div>
                                    <div class="fp-box">
                                        <p>(Middle Name):</p>
                                        <input type="text" name="children[${index}][mname]" value="${child.mname || ''}">
                                    </div>
                                    <div class="fp-box">
                                        <p>(Suffix):</p>
                                        <input type="text" name="children[${index}][sfx]" value="${child.sfx || ''}">
                                    </div>
                                    <div class="fp-box">
                                        <p>Date of Birth (MM/DD/YYYY):</p>
                                        <input type="date" name="children[${index}][dbirth]" value="${child.dbirth || ''}">
                                    </div>
                                </div>
                            `;

                            container.appendChild(newChild);
                        });
                    }

                    // Fill employment fields if available
                    if (employment) {
                        document.querySelector('input[name="profession"]').value = employment.profession || '';
                        document.querySelector('input[name="ystart"]').value = employment.ystart || '';
                        document.querySelector('input[name="mearning"]').value = employment.mearning || '';
                        document.querySelector('input[name="faddress"]').value = employment.faddress || '';

                        if (employment.ofw_monthly_earnings) {
                            document.querySelector('input[name="ofw_monthly_earnings"]').value = employment.ofw_monthly_earnings;
                        }

                        document.querySelector('input[name="spouse-ssnum"]').value = employment.spouse_ssnum || '';
                        document.querySelector('input[name="ffprogram"]').value = employment.ffprogram || '';
                        document.querySelector('input[name="ffp"]').value = employment.ffp || '';
                    }

                } else {
                    // alert('Applicant not found');
                }
            } catch (error) {
                console.error('Error loading applicant data:', error);
                // alert('Error loading applicant data');
            }
        }

        // Show success message if form was submitted
        if (sessionStorage.getItem('formSuccess') === 'true') {
            document.getElementById('success-message').style.display = 'block';
            sessionStorage.removeItem('formSuccess');
            setTimeout(function() {
                document.getElementById('success-message').style.display = 'none';
            }, 5000);
        }

        // Auto-uppercase text inputs
        const textInputs = document.querySelectorAll('input[type="text"]');
        textInputs.forEach(input => {
            input.addEventListener('input', function() {
                this.value = this.value.toUpperCase();
            });
        });

        // Civil Status Others field toggle
        const cvstatusRadios = document.querySelectorAll('.cvstatus-radio');
        const cvstatusOtherInput = document.getElementById('cvstatus-other-input');

        cvstatusRadios.forEach(radio => {
            radio.addEventListener('change', function() {
                if (this.id === 'cvstatus-others' && this.checked) {
                    cvstatusOtherInput.disabled = false;
                    cvstatusOtherInput.focus();
                } else {
                    cvstatusOtherInput.disabled = true;
                    cvstatusOtherInput.value = '';
                }
            });
        });

        // Same as Home Address functionality
        const sameAddressCheckbox = document.getElementById('same-address-checkbox');
        const pbirthInput = document.getElementById('pbirth-input');
        const addressLayer2 = document.getElementById('address-layer2');
        const address5Input = document.getElementById('address-5'); // Barangay
        const address6Input = document.getElementById('address-6-input'); // City
        const address7Input = document.getElementById('address-7-input'); // Province
        const address8Input = document.getElementById('address-8-input'); // Country
        const address9Input = document.getElementById('address-9'); // Zip Code

        sameAddressCheckbox.addEventListener('change', function() {
            if (this.checked) {
                addressLayer2.style.opacity = '0.5';
                addressLayer2.style.pointerEvents = 'none';

                const pbirth = pbirthInput.value;
                if (pbirth) {
                    const parts = pbirth.split(',').map(part => part.trim());

                    // Extract parts: [barangay, city, province, country, zip] or similar
                    if (parts.length >= 1) {
                        address5Input.value = parts[0] || '';
                    }
                    if (parts.length >= 2) {
                        address6Input.value = parts[1] || '';
                    }
                    if (parts.length >= 3) {
                        address7Input.value = parts[2] || '';
                    }
                    if (parts.length >= 4) {
                        address8Input.value = parts[3] || 'PHILIPPINES'; // Default to PHILIPPINES if not specified
                    }
                    if (parts.length >= 5) {
                        address9Input.value = parts[4] || '';
                    }
                }

                // Update hidden field to indicate address is same as place of birth
                document.getElementById('same-as-pbirth-hidden').value = '1';
            } else {
                addressLayer2.style.opacity = '1';
                addressLayer2.style.pointerEvents = 'auto';

                // Clear all address fields when unchecked
                address5Input.value = '';
                address6Input.value = '';
                address7Input.value = '';
                address8Input.value = 'PHILIPPINES'; // Reset to default
                address9Input.value = '';

                // Update hidden field to indicate address is NOT same as place of birth
                document.getElementById('same-as-pbirth-hidden').value = '0';
            }
        });

        pbirthInput.addEventListener('input', function() {
            if (sameAddressCheckbox.checked) {
                const pbirth = this.value;
                const parts = pbirth.split(',').map(part => part.trim());

                // Update address fields in real-time as user types
                if (parts.length >= 1) {
                    address5Input.value = parts[0] || '';
                }
                if (parts.length >= 2) {
                    address6Input.value = parts[1] || '';
                }
                if (parts.length >= 3) {
                    address7Input.value = parts[2] || '';
                }
                if (parts.length >= 4) {
                    address8Input.value = parts[3] || 'PHILIPPINES';
                }
                if (parts.length >= 5) {
                    address9Input.value = parts[4] || '';
                }
            }
        });

        // Add child functionality
        let childCount = 1;

        document.getElementById('add-child-btn').addEventListener('click', function() {
            const container = document.getElementById('children-container');
            const newChild = document.createElement('div');
            newChild.className = 'child-entry';
            newChild.setAttribute('data-child-num', childCount + 1);

            newChild.innerHTML = `
                <p>Child ${childCount + 1}</p>
                <div class="child-fields">
                    <div class="fp-box">
                        <p>(Last Name):</p>
                        <input type="text" name="children[${childCount}][lname]">
                    </div>
                    <div class="fp-box">
                        <p>(First Name):</p>
                        <input type="text" name="children[${childCount}][fname]">
                    </div>
                    <div class="fp-box">
                        <p>(Middle Name):</p>
                        <input type="text" name="children[${childCount}][mname]">
                    </div>
                    <div class="fp-box">
                        <p>(Suffix):</p>
                        <input type="text" name="children[${childCount}][sfx]">
                    </div>
                    <div class="fp-box">
                        <p>Date of Birth (MM/DD/YYYY):</p>
                        <input type="date" name="children[${childCount}][dbirth]">
                    </div>
                </div>
            `;

            container.appendChild(newChild);
            childCount++;
        });


        // Function to handle the update operation
        async function updateRecord() {
            const formData = new FormData(document.querySelector('form'));

            try {
                const response = await fetch('page1.php?action=update', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (result.success) {
                    // alert('Record updated successfully');
                    window.location.href = '../crud/crud.html'; // Redirect back to CRUD page
                } else {
                    // alert('Error updating record: ' + result.message);
                }
            } catch (error) {
                console.error('Error updating record:', error);
                // alert('Error updating record');
            }
        }
    </script>
</body>
</html>